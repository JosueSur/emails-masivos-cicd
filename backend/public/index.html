<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    
    <link rel="stylesheet" href="css/uikit.min.css" />
    <link rel="stylesheet" href="css/main.css" />
    
    <script src="js/uikit.min.js"></script>
    <script src="js/uikit-icons.min.js"></script>

    <script src="js/jquery-3.6.0.min.js"></script>

    
    <title>Emails masivos</title>
</head>
<body>
    <div class="uk-flex uk-flex-center uk-flex-middle" uk-height-viewport="offset-top: true">
        <div class="uk-card uk-card-default uk-card-body uk-width-1-3@m uk-text-center">

            <img data-src="img/logo.png" width="60%" height="100" alt="logo" class="uk-margin" uk-img>
            <p>Emails masivos</p>
            <form class="uk-form-stacked uk-padding">

                <div class="uk-margin">
                    <label class="uk-form-label" for="form-stacked-text">Usuario</label>
                    <div class="uk-form-controls">
                        <div class="uk-inline">
                            <span class="uk-form-icon user" id="user" uk-icon="icon: user"></span>
                            <input id="usuario" class="uk-input" type="text">
                        </div>
                    </div>
                </div>
            
                <div class="uk-margin">
                    <label class="uk-form-label" for="form-stacked-text">Contraseña</label>
                    <div class="uk-form-controls">
                        <div class="uk-inline">
                            <span class="uk-form-icon" uk-icon="icon: unlock"></span>
                            <input id="password" class="uk-input" type="password">
                        </div>
                    </div>
                </div>

                <div class="uk-alert-danger" id="alert" uk-alert hidden>
                    <a class="uk-alert-close" uk-close></a>
                    <p class="uk-text-bold">Los datos ingresados no son validos.</p>
                </div>

                <div class="uk-alert-danger" id="alert-vacio" uk-alert hidden>
                    <a class="uk-alert-close" uk-close></a>
                    <p class="uk-text-bold">Los campos usuario y contraseña son obligatorios.</p>
                </div>               

                <div class="uk-margin">
                    <button id="login" class="uk-button uk-button-primary">Ingresar</button>
                </div>

            </form>
        </div>
    </div>

    <script>
        $(document).ready(function() {

            localStorage.removeItem('email');
            localStorage.removeItem('id');
            localStorage.removeItem('roleid');
            $('#usuario').empty();
            $('#password').empty();
            
            $("#login").click(function (e) {

                e.preventDefault();

                const usuario = $("#usuario").val();
                const password = $("#password").val();

                if (usuario == '' || password == ''){
                    $('#alert-vacio').removeAttr('hidden');
                    return;
                }else{

                    $("#alert-vacio").attr("hidden",true);

                    $.ajax({
                        url: window.location.origin+'/api/users/login',
                        type: 'POST',
                        data: "usuario=" + usuario + "&password=" + password,
                        global: false,
                        success: function (data) {                                                                                                                                 
                            if(data == "Unable to login"){
                                $('#alert').removeAttr('hidden');
                            }else{    
                                localStorage.setItem("usuario", data.data.username);
                                localStorage.setItem("id", data.data.id);
                                localStorage.setItem("roleid", data.data.roleId)
                                if(data.data.roleId == 1){
                                    location.href = window.location.origin+"/panel-control.html";
                                } else {
                                    location.href = window.location.origin+"/dashboard.html";
                                }                           
                            }
                        }
                    });
                }
            });
        });
    </script>
</body>
</html>